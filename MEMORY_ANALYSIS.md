# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é –≤ hik-anpr-wrapper

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑ –ª–æ–≥–æ–≤ –≤–∏–¥–Ω–æ, —á—Ç–æ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —Å–µ—Ä–≤–∏—Å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```
==> Running 'uvicorn api:app --host 0.0.0.0 --port 8000'
Creating model: ('PP-OCRv5_server_det', None)
...
```

**–ü—Ä–∏—á–∏–Ω–∞:** Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–∏:
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏ (2 GB)
- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö
- –û—à–∏–±–∫–∞—Ö –≤ –∫–æ–¥–µ

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ú–æ–¥–µ–ª–∏ PaddleOCR –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (~500-800 –ú–ë)
- –ú–æ–¥–µ–ª–∏ YOLO –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ (~100-200 –ú–ë)
- –ü–æ—Ç–µ—Ä—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ (–±—É—Ñ–µ—Ä—ã, –æ—á–µ—Ä–µ–¥–∏)

### 2. –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –ø–∞–º—è—Ç–∏ –±–µ–∑ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å–æ–¥–µ—Ä–∂–∏—Ç 3-4 –ú–ë –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:
- `detectionPicture.jpg`: ~2 –ú–ë
- `featurePicture.jpg`: ~1.8 –ú–ë  
- `licensePlatePicture.jpg`: ~1.5 –ö–ë
- `snowSnapshot.jpg`: ~400-500 –ö–ë

**–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è:**
- –í `api.py`: `detection_bytes`, `feature_bytes`, `license_bytes`, `snow_photo_bytes`
- –í `combined_merger.py`: —Å–æ–±—ã—Ç–∏—è —Ö—Ä–∞–Ω—è—Ç –±–∞–π—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –í –æ—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π: –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —è–≤–Ω–æ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### 3. –ë—É—Ñ–µ—Ä –∫–∞–¥—Ä–æ–≤ snow_worker –ø–µ—Ä–µ–ø–æ–ª–Ω—è–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ë—É—Ñ–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –¥–æ 300 –∫–∞–¥—Ä–æ–≤:
```python
_frame_buffer: deque[TimestampedFrame] = deque(maxlen=300)  # ~10 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 30 FPS
```

**–†–∞—Å—á–µ—Ç –ø–∞–º—è—Ç–∏:**
- –†–∞–∑–º–µ—Ä –∫–∞–¥—Ä–∞: 1280x720x3 = ~2.7 –ú–ë (numpy array)
- 300 –∫–∞–¥—Ä–æ–≤ = ~810 –ú–ë —Ç–æ–ª—å–∫–æ –Ω–∞ –±—É—Ñ–µ—Ä!
- –ü—Ä–∏ 30 FPS —ç—Ç–æ ~10 —Å–µ–∫—É–Ω–¥ –∏—Å—Ç–æ—Ä–∏–∏

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
- –ö—ç—à –¥–µ—Ç–µ–∫—Ü–∏–π: `_detection_cache` —Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ timestamp
- –ö–∞–∂–¥—ã–π –∫–∞–¥—Ä –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è: `frame.copy()` –≤ —Å—Ç—Ä–æ–∫–µ 810

### 4. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–æ–ø–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –º–Ω–æ–≥–æ `.copy()` –¥–ª—è numpy arrays:
- `snow_worker.py:810`: `frame.copy()`
- `snow_worker.py:595`: `frame.copy()` –≤ capture_snow_photo
- –ü—Ä–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ –º–∞—Å—Å–∏–≤—ã

### 5. –ú–æ–¥–µ–ª–∏ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏
**PaddleOCR:**
- –î–µ—Ç–µ–∫—Ç–æ—Ä: ~200-300 –ú–ë
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç–µ–ª—å: ~100-200 –ú–ë
- –ò—Ç–æ–≥–æ: ~400-500 –ú–ë

**YOLO:**
- –î–µ—Ç–µ–∫—Ç–æ—Ä –Ω–æ–º–µ—Ä–æ–≤: ~100 –ú–ë
- –î–µ—Ç–µ–∫—Ç–æ—Ä –≥—Ä—É–∑–æ–≤–∏–∫–æ–≤ (snow_worker): ~100 –ú–ë
- –ò—Ç–æ–≥–æ: ~200 –ú–ë

**–û–±—â–∏–π –æ–±—ä–µ–º –º–æ–¥–µ–ª–µ–π:** ~600-700 –ú–ë

### 6. –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—á–µ—Ä–µ–¥—å –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ 100 —Å–æ–±—ã—Ç–∏–π:
```python
_event_queue = asyncio.Queue(maxsize=100)
```

–ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- 3-4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (3-4 –ú–ë)
- JSON –¥–∞–Ω–Ω—ã–µ
- –ò—Ç–æ–≥–æ: ~3-4 –ú–ë –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
- –ü—Ä–∏ –ø–æ–ª–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏: ~300-400 –ú–ë

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç –ø–∞–º—è—Ç–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–∞–º—è—Ç—å |
|-----------|--------|
| –ú–æ–¥–µ–ª–∏ (PaddleOCR + YOLO) | ~600-700 –ú–ë |
| –ë—É—Ñ–µ—Ä –∫–∞–¥—Ä–æ–≤ (300 –∫–∞–¥—Ä–æ–≤) | ~810 –ú–ë |
| –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π (100 —Å–æ–±—ã—Ç–∏–π √ó 4 –ú–ë) | ~400 –ú–ë |
| –¢–µ–∫—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) | ~4 –ú–ë |
| –ö—ç—à–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | ~100-200 –ú–ë |
| **–ò–¢–û–ì–û** | **~1.9-2.1 –ì–ë** |

**–õ–∏–º–∏—Ç Render:** 2 GB

**–í—ã–≤–æ–¥:** –°–µ—Ä–≤–∏—Å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç –ø–∞–º—è—Ç–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º.

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –∫–∞–¥—Ä–æ–≤
**–¢–µ–∫—É—â–µ–µ:** 300 –∫–∞–¥—Ä–æ–≤ (~10 —Å–µ–∫—É–Ω–¥)
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ:** 60-90 –∫–∞–¥—Ä–æ–≤ (~2-3 —Å–µ–∫—É–Ω–¥—ã)

```python
_frame_buffer: deque[TimestampedFrame] = deque(maxlen=90)  # ~3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 30 FPS
```

**–≠–∫–æ–Ω–æ–º–∏—è:** ~630 –ú–ë

### 2. –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:
- –£–¥–∞–ª—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ø–∞–º—è—Ç–∏
- –í—ã–∑—ã–≤–∞—Ç—å `gc.collect()`
- –û—á–∏—â–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ numpy arrays

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç—å –ø–æ–ª–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –≤–º–µ—Å—Ç–æ –∫–æ–ø–∏–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
- –°–∂–∏–º–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –æ—á–µ—Ä–µ–¥—å

### 4. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
–£–º–µ–Ω—å—à–∏—Ç—å `maxsize` –æ—á–µ—Ä–µ–¥–∏ —Å 100 –¥–æ 10-20 —Å–æ–±—ã—Ç–∏–π.

### 5. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
–õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

### 6. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å capture_snow_photo
- –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ 5 –∫–∞–¥—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤
- –û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∫–∞–¥—Ä–∞

## üõ†Ô∏è –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. ‚úÖ –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –∫–∞–¥—Ä–æ–≤
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —è–≤–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å capture_snow_photo
4. ‚úÖ –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏

