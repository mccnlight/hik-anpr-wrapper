# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –ø–∞–º—è—Ç—å—é

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –∫–∞–¥—Ä–æ–≤
**–§–∞–π–ª:** `snow_worker.py`
- **–ë—ã–ª–æ:** 300 –∫–∞–¥—Ä–æ–≤ (~10 —Å–µ–∫—É–Ω–¥, ~810 –ú–ë –ø–∞–º—è—Ç–∏)
- **–°—Ç–∞–ª–æ:** 90 –∫–∞–¥—Ä–æ–≤ (~3 —Å–µ–∫—É–Ω–¥—ã, ~243 –ú–ë –ø–∞–º—è—Ç–∏)
- **–≠–∫–æ–Ω–æ–º–∏—è:** ~567 –ú–ë

```python
_frame_buffer: deque[TimestampedFrame] = deque(maxlen=90)  # ~3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 30 FPS
BUFFER_DURATION_SECONDS = 3.0  # –•—Ä–∞–Ω–∏–º –∫–∞–¥—Ä—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥—ã
```

### 2. –£–º–µ–Ω—å—à–µ–Ω —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π
**–§–∞–π–ª:** `api.py`
- **–ë—ã–ª–æ:** 100 —Å–æ–±—ã—Ç–∏–π (~400 –ú–ë –ø–∞–º—è—Ç–∏)
- **–°—Ç–∞–ª–æ:** 20 —Å–æ–±—ã—Ç–∏–π (~80 –ú–ë –ø–∞–º—è—Ç–∏)
- **–≠–∫–æ–Ω–æ–º–∏—è:** ~320 –ú–ë

```python
_event_queue = asyncio.Queue(maxsize=20)
```

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–æ–≤ –≤ capture_snow_photo
**–§–∞–π–ª:** `snow_worker.py`
- **–ë—ã–ª–æ:** 5 –∫–∞–¥—Ä–æ–≤ (3, 4, 5, 6, 7 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥), 3 –ø–æ—Ç–æ–∫–∞
- **–°—Ç–∞–ª–æ:** 3 –∫–∞–¥—Ä–∞ (2, 3, 4 —Å–µ–∫—É–Ω–¥—ã –Ω–∞–∑–∞–¥), 2 –ø–æ—Ç–æ–∫–∞
- **–≠–∫–æ–Ω–æ–º–∏—è:** ~40% –ø–∞–º—è—Ç–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É

```python
target_delays = [2.0, 3.0, 4.0]  # —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
with concurrent.futures.ThreadPoolExecutor(max_workers=2) as executor:
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–æ —è–≤–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
**–§–∞–π–ª—ã:** `api.py`, `snow_worker.py`

#### –í `_process_event_background`:
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –í—ã–∑–æ–≤ `gc.collect()` –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏

```python
finally:
    del detection_bytes, feature_bytes, license_bytes, snow_photo_bytes
    del plate_photo_1, plate_photo_2
    gc.collect()
```

#### –í `capture_snow_photo`:
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–∞–¥—Ä–∞
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ ANPR –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 5. –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
**–§–∞–π–ª:** `api.py`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `psutil` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–º—è—Ç–∏

```python
process = psutil.Process(os.getpid())
mem_info = process.memory_info()
mem_mb = mem_info.rss / 1024 / 1024
print(f"[PROCESS] Memory: {mem_mb:.1f} MB")
```

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –≠–∫–æ–Ω–æ–º–∏—è |
|-----------|------|-------|----------|
| –ë—É—Ñ–µ—Ä –∫–∞–¥—Ä–æ–≤ | ~810 –ú–ë | ~243 –ú–ë | ~567 –ú–ë |
| –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π | ~400 –ú–ë | ~80 –ú–ë | ~320 –ú–ë |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–¥—Ä–æ–≤ | ~200 –ú–ë | ~120 –ú–ë | ~80 –ú–ë |
| **–ò–¢–û–ì–û** | **~1.4 –ì–ë** | **~443 –ú–ë** | **~967 –ú–ë** |

**–ò—Ç–æ–≥–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:**
- –ú–æ–¥–µ–ª–∏: ~600-700 –ú–ë
- –ë—É—Ñ–µ—Ä –∫–∞–¥—Ä–æ–≤: ~243 –ú–ë
- –û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π: ~80 –ú–ë
- –¢–µ–∫—É—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: ~4 –ú–ë
- –ö—ç—à–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ~100-200 –ú–ë
- **–ò–¢–û–ì–û: ~1.0-1.2 –ì–ë** (–±—ã–ª–æ ~1.9-2.1 –ì–ë)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ —Å–Ω–∏–∂–µ–Ω–æ –Ω–∞ ~50%, —á—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –≤ 2 GB.

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:
- `[PROCESS] Memory at start: X MB`
- `[PROCESS] Memory after cleanup: X MB`

–ï—Å–ª–∏ –ø–∞–º—è—Ç—å –≤—Å–µ –µ—â–µ —Ä–∞—Å—Ç–µ—Ç, –≤–æ–∑–º–æ–∂–Ω–æ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ —É—Ç–µ—á–∫–∏.

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Render
–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ:
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –ø–∞–º—è—Ç–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ health checks –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤

### 3. –î–∞–ª—å–Ω–µ–π—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª–µ–µ –ª–µ–≥–∫–∏—Ö –º–æ–¥–µ–ª–µ–π
- –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë—É—Ñ–µ—Ä –∫–∞–¥—Ä–æ–≤:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å 10 –¥–æ 3 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞—Ö–≤–∞—Ç–∞ —Å–Ω–µ–≥–æ–≤—ã—Ö —Ñ–æ—Ç–æ. –ï—Å–ª–∏ –∫–∞—á–µ—Å—Ç–≤–æ —É—Ö—É–¥—à–∏–ª–æ—Å—å, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 5 —Å–µ–∫—É–Ω–¥ (150 –∫–∞–¥—Ä–æ–≤).

2. **–û—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Å 100 –¥–æ 20 —Å–æ–±—ã—Ç–∏–π –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ —Å–æ–±—ã—Ç–∏—è –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å—Å—è. –ï—Å–ª–∏ —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 30-40.

3. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –£–º–µ–Ω—å—à–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ —Å 3 –¥–æ 2 –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É, –Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏.

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ Render
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –±–æ–ª—å—à–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

